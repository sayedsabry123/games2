<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مكتبة الطلبة - متجر المستلزمات الدراسية</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&display=swap" rel="stylesheet">
    <style>
        /* أنماط صفحة تسجيل الدخول */
        .login-container {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }
        
        .login-form {
            background-color: white;
            padding: 2rem;
            border-radius: 10px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.2);
        }
        
        .login-form h2 {
            text-align: center;
            margin-bottom: 1.5rem;
            color: var(--primary-color);
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }
        
        .form-group input {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }
        
        .login-btn {
            width: 100%;
            padding: 0.8rem;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .login-btn:hover {
            background-color: #2980b9;
        }
        
        .admin-panel {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: white;
            z-index: 2000;
            overflow-y: auto;
            padding: 2rem;
        }
        
        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #eee;
        }
        
        .admin-products {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }
        
        .admin-product-form {
            background-color: #f9f9f9;
            padding: 1.5rem;
            border-radius: 8px;
        }
        
        .admin-product-form h3 {
            margin-bottom: 1rem;
            color: var(--primary-color);
        }
        
        textarea {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
            resize: vertical;
            min-height: 100px;
            font-family: 'Tajawal', sans-serif;
        }
        
        .logout-btn {
            background-color: var(--accent-color);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            cursor: pointer;
        }
        
        /* شريط التنقل العلوي */
        .admin-nav {
            background-color: var(--dark-color);
            padding: 0.5rem 1rem;
            display: flex;
            justify-content: flex-end;
        }
        
        .admin-nav-link {
            color: white;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            transition: background-color 0.3s;
        }
        
        .admin-nav-link:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        /* باقي الأنماط الموجودة مسبقًا */
        :root {
            --primary-color: #3498db;
            --secondary-color: #2ecc71;
            --accent-color: #e74c3c;
            --light-color: #f5f7fa;
            --dark-color: #2c3e50;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --text-color: #34495e;
            --border-color: #dfe6e9;
            --tab-bg: #ffffff;
            --tab-hover-bg: #f8f9fa;
            --tab-active-bg: #e3f2fd;
            --tab-indicator: #e74c3c;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Tajawal', sans-serif;
        }
        
        body {
            background-color: var(--light-color);
            color: var(--text-color);
            overflow-x: hidden;
            font-weight: 400;
            line-height: 1.6;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary-color), #2980b9);
            color: white;
            padding: 1rem;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            position: relative;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
        }
        
        .logo {
            font-size: 1.8rem;
            font-weight: 800;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: transform 0.3s ease;
            color: white;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .logo:hover {
            transform: scale(1.05);
        }
        
        .logo img {
            height: 45px;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
        }
        
        .header-cart {
            display: flex;
            align-items: center;
            gap: 15px;
            position: relative;
        }
        
        .header-cart-icon {
            position: relative;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        
        .header-cart-icon:hover {
            transform: scale(1.1);
        }
        
        .header-cart-icon i {
            font-size: 1.8rem;
            color: white;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .header-cart-count {
            position: absolute;
            top: -5px;
            left: -5px;
            background-color: var(--accent-color);
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }
        
        /* تحسينات التبويبات - النسخة المحسنة */
        .tabs-container {
            width: 100%;
            overflow-x: auto;
            background-color: var(--tab-bg);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 99;
            -webkit-overflow-scrolling: touch;
            padding: 0.5rem 0;
        }
        
        .tabs-scroll-wrapper {
            position: relative;
            width: 100%;
        }
        
        .tabs {
            display: flex;
            width: max-content;
            padding: 0 10px;
            position: relative;
        }
        
        .tab {
            padding: 1rem 1.8rem;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.3s ease;
            font-weight: 600;
            position: relative;
            overflow: hidden;
            color: var(--text-color);
            font-size: 1rem;
            margin: 0 2px;
            background-color: transparent;
            border-radius: 8px 8px 0 0;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }
        
        .tab:hover {
            background-color: var(--tab-hover-bg);
            color: var(--primary-color);
        }
        
        .tab.active {
            color: var(--accent-color);
            font-weight: 700;
        }
        
        .tab-icon {
            font-size: 1.2rem;
            margin-bottom: 0.4rem;
            transition: all 0.3s ease;
        }
        
        .tab:hover .tab-icon {
            transform: translateY(-3px);
        }
        
        .tab.active .tab-icon {
            color: var(--accent-color);
            animation: pulse 1.5s infinite;
        }
        
        .tab-text {
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }
        
        .tab-indicator {
            position: absolute;
            bottom: 0;
            height: 3px;
            background-color: var(--tab-indicator);
            border-radius: 3px 3px 0 0;
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            box-shadow: 0 2px 5px rgba(231, 76, 60, 0.3);
        }
        
        /* شريط البحث */
        .search-container {
            padding: 1rem;
            background-color: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: sticky;
            top: 60px;
            z-index: 98;
        }
        
        .search-box {
            display: flex;
            align-items: center;
            background-color: #f5f5f5;
            border-radius: 30px;
            padding: 0.5rem 1rem;
            transition: all 0.3s ease;
        }
        
        .search-box:focus-within {
            box-shadow: 0 0 0 2px var(--secondary-color);
            background-color: white;
        }
        
        .search-box input {
            flex: 1;
            border: none;
            background: transparent;
            padding: 0.5rem;
            font-size: 1rem;
            outline: none;
            color: var(--text-color);
            font-weight: 400;
        }
        
        .search-box i {
            color: #666;
            margin-left: 0.5rem;
        }
        
        .container {
            max-width: 1200px;
            margin: 1.5rem auto;
            padding: 0 1rem;
        }
        
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1.2rem;
        }
        
        .product-card {
            background-color: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
            position: relative;
            border: 1px solid var(--border-color);
        }
        
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
            border-color: var(--secondary-color);
        }
        
        .product-image {
            height: 180px;
            overflow: hidden;
            position: relative;
            cursor: pointer;
        }
        
        .product-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease, filter 0.3s ease;
        }
        
        .product-card:hover .product-image img {
            transform: scale(1.05);
            filter: brightness(1.05);
        }
        
        .product-badge {
            position: absolute;
            top: 10px;
            left: 10px;
            background-color: var(--accent-color);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
            z-index: 2;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            animation: pulse 2s infinite;
        }
        
        .product-info {
            padding: 1.2rem;
            position: relative;
        }
        
        .product-name {
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
            color: var(--dark-color);
            font-weight: 700;
            transition: color 0.3s ease;
        }
        
        .product-card:hover .product-name {
            color: var(--primary-color);
        }
        
        .product-desc {
            color: #666;
            margin-bottom: 1rem;
            font-size: 0.85rem;
            line-height: 1.5;
            font-weight: 400;
        }
        
        .product-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            font-size: 0.85rem;
        }
        
        .product-availability {
            color: var(--success-color);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.8rem;
        }
        
        .product-availability::before {
            content: '✓';
        }
        
        .product-rating {
            color: var(--warning-color);
            display: flex;
            align-items: center;
            gap: 3px;
            font-size: 0.8rem;
        }
        
        .product-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .product-tag {
            background-color: var(--light-color);
            color: var(--dark-color);
            padding: 0.25rem 0.5rem;
            border-radius: 20px;
            font-size: 0.75rem;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .product-tag:hover {
            background-color: var(--secondary-color);
            color: white;
            transform: translateY(-2px);
        }
        
        .add-to-cart {
            width: 100%;
            padding: 0.7rem;
            background: linear-gradient(135deg, var(--primary-color), #2980b9);
            color: white;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            position: relative;
            overflow: hidden;
            font-size: 0.9rem;
        }
        
        .add-to-cart:hover {
            background: linear-gradient(135deg, #2980b9, var(--primary-color));
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(41, 128, 185, 0.3);
        }
        
        .add-to-cart::after {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 20px;
            height: 100px;
            background: rgba(255, 255, 255, 0.2);
            transform: rotate(30deg);
            transition: all 0.3s;
        }
        
        .add-to-cart:hover::after {
            right: 120%;
        }
        
        /* باقي الأنماط... */
        
        /* أنماط خاصة بالمنتج المضاف حديثًا */
        .new-product-highlight {
            animation: highlight 2s ease-in-out;
            border: 2px solid var(--secondary-color);
        }
        
        @keyframes highlight {
            0% { box-shadow: 0 0 0 0 rgba(46, 204, 113, 0.7); }
            70% { box-shadow: 0 0 0 20px rgba(46, 204, 113, 0); }
            100% { box-shadow: 0 0 0 0 rgba(46, 204, 113, 0); }
        }
    </style>
</head>
<body>
    <!-- شريط التنقل العلوي -->
    <div class="admin-nav">
        <a href="#" class="admin-nav-link" id="admin-link">رفع المنتجات</a>
    </div>

    <!-- نافذة تسجيل الدخول -->
    <div class="login-container" id="login-container">
        <div class="login-form">
            <h2>تسجيل الدخول كمسؤول</h2>
            <div class="form-group">
                <label for="admin-phone">رقم الهاتف</label>
                <input type="tel" id="admin-phone" placeholder="أدخل رقم الهاتف" value="01020990515">
            </div>
            <div class="form-group">
                <label for="admin-password">كلمة المرور</label>
                <input type="password" id="admin-password" placeholder="أدخل كلمة المرور" value="admin">
            </div>
            <button class="login-btn" id="login-btn">دخول</button>
        </div>
    </div>

    <!-- لوحة تحكم المسؤول -->
    <div class="admin-panel" id="admin-panel">
        <div class="admin-header">
            <h2>لوحة تحكم المسؤول - إدارة المنتجات</h2>
            <button class="logout-btn" id="logout-btn">تسجيل الخروج</button>
        </div>
        
        <div class="admin-products">
            <div class="admin-product-form">
                <h3>إضافة منتج جديد</h3>
                <div class="form-group">
                    <label for="product-name">اسم المنتج</label>
                    <input type="text" id="product-name" placeholder="اسم المنتج" value="قلم حبر جاف عالي الجودة">
                </div>
                <div class="form-group">
                    <label for="product-price">السعر</label>
                    <input type="number" id="product-price" placeholder="السعر" value="15">
                </div>
                <div class="form-group">
                    <label for="product-desc">الوصف</label>
                    <textarea id="product-desc" placeholder="وصف المنتج">قلم حبر جاف عالي الجودة، يكتب بسلاسة ومناسب للاستخدام اليومي والكتابة لفترات طويلة.</textarea>
                </div>
                <div class="form-group">
                    <label for="product-image">رابط الصورة الرئيسية</label>
                    <input type="text" id="product-image" placeholder="رابط الصورة" value="https://i.postimg.cc/xTfBwVKQ/image.jpg">
                </div>
                <div class="form-group">
                    <label for="product-images">روابط الصور الإضافية (افصل بينهم بفاصلة)</label>
                    <textarea id="product-images" placeholder="روابط الصور الإضافية">https://i.postimg.cc/xTfBwVKQ/image.jpg, https://i.postimg.cc/xTfBwVKQ/image.jpg</textarea>
                </div>
                <div class="form-group">
                    <label for="product-category">الفئة</label>
                    <select id="product-category">
                        <option value="student">مستلزمات طلابية</option>
                        <option value="office">أدوات مكتبية</option>
                        <option value="games">ألعاب</option>
                        <option value="engineering">أدوات هندسية</option>
                        <option value="lab">أدوات معملية</option>
                        <option value="art">أدوات رسم</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="product-tags">الكلمات الدلالية (افصل بينهم بفاصلة)</label>
                    <input type="text" id="product-tags" placeholder="كلمات دلالية" value="أقلام, قرطاسية, أدوات مكتبية">
                </div>
                <button class="login-btn" id="add-product-btn">إضافة المنتج</button>
            </div>
            
            <div id="admin-products-list">
                <!-- هنا سيتم عرض المنتجات الموجودة -->
            </div>
        </div>
    </div>

    <!-- باقي محتوى الصفحة الأصلي -->
    <header>
        <div class="logo">
            <img src="https://i.postimg.cc/x1Xncp9W/logo.png" alt="مكتبة الطلبة">
            <span>مكتبة الطلبة</span>
        </div>
        <div class="header-cart">
            <div class="header-cart-icon" id="header-cart-icon">
                <i class="fas fa-shopping-basket"></i>
                <span class="header-cart-count" id="header-cart-count">0</span>
            </div>
        </div>
    </header>
    
    <div class="tabs-container">
        <div class="tabs-scroll-wrapper">
            <div class="tabs" id="tabs">
                <div class="tab active" data-category="all">
                    <i class="fas fa-th-large tab-icon"></i>
                    <span class="tab-text">الكل</span>
                </div>
                <div class="tab" data-category="student">
                    <i class="fas fa-graduation-cap tab-icon"></i>
                    <span class="tab-text">مستلزمات طلابية</span>
                </div>
                <div class="tab" data-category="office">
                    <i class="fas fa-briefcase tab-icon"></i>
                    <span class="tab-text">أدوات مكتبية</span>
                </div>
                <div class="tab" data-category="games">
                    <i class="fas fa-gamepad tab-icon"></i>
                    <span class="tab-text">ألعاب</span>
                </div>
                <div class="tab" data-category="engineering">
                    <i class="fas fa-ruler-combined tab-icon"></i>
                    <span class="tab-text">أدوات هندسية</span>
                </div>
                <div class="tab" data-category="lab">
                    <i class="fas fa-flask tab-icon"></i>
                    <span class="tab-text">أدوات معملية</span>
                </div>
                <div class="tab" data-category="art">
                    <i class="fas fa-palette tab-icon"></i>
                    <span class="tab-text">أدوات رسم</span>
                </div>
            </div>
            <div class="tab-indicator" id="tab-indicator"></div>
        </div>
    </div>
    
    <div class="search-container">
        <div class="search-box">
            <input type="text" id="search-input" placeholder="ابحث عن منتج...">
            <i class="fas fa-search"></i>
        </div>
    </div>
    
    <div class="container">
        <h2 style="text-align: center; margin-bottom: 20px; color: var(--primary-color);">المنتج المضاف حديثاً سيظهر هنا:</h2>
        <div class="products-grid" id="products-container">
            <!-- المنتجات ستظهر هنا -->
            <div class="product-card new-product-highlight">
                <div class="product-image" data-id="1001">
                    <img src="https://i.postimg.cc/xTfBwVKQ/image.jpg" alt="قلم حبر جاف عالي الجودة">
                    <span class="product-badge">جديد</span>
                </div>
                <div class="product-info">
                    <h3 class="product-name">قلم حبر جاف عالي الجودة</h3>
                    <p class="product-desc">قلم حبر جاف عالي الجودة، يكتب بسلاسة ومناسب للاستخدام اليومي والكتابة لفترات طويلة.</p>
                    <div class="product-meta">
                        <span class="product-availability">متوفر</span>
                        <span class="product-rating">★★★★★</span>
                    </div>
                    <div class="product-tags">
                        <span class="product-tag">أقلام</span>
                        <span class="product-tag">قرطاسية</span>
                        <span class="product-tag">أدوات مكتبية</span>
                    </div>
                    <button class="add-to-cart" data-id="1001">
                        <i class="fas fa-cart-plus"></i>
                        أضف للسلة - 15 ج.م
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // بيانات الاعتماد المسموح بها
        const ADMIN_CREDENTIALS = {
            phone: "01020990515",
            password: "admin"
        };

        // عناصر DOM
        const loginContainer = document.getElementById('login-container');
        const adminPanel = document.getElementById('admin-panel');
        const loginBtn = document.getElementById('login-btn');
        const logoutBtn = document.getElementById('logout-btn');
        const addProductBtn = document.getElementById('add-product-btn');
        const adminProductsList = document.getElementById('admin-products-list');
        const productsContainer = document.getElementById('products-container');
        const adminLink = document.getElementById('admin-link');

        // فتح نافذة تسجيل الدخول عند النقر على رابط "رفع المنتجات"
        adminLink.addEventListener('click', (e) => {
            e.preventDefault();
            loginContainer.style.display = 'flex';
        });

        // التحقق من حالة تسجيل الدخول عند تحميل الصفحة
        window.addEventListener('load', () => {
            const isLoggedIn = localStorage.getItem('adminLoggedIn');
            if (isLoggedIn) {
                // إذا كان المستخدم مسجلاً، لا تظهر نافذة تسجيل الدخول تلقائياً
                loginContainer.style.display = 'none';
            }
            // تحميل المنتجات من قاعدة البيانات
            loadProductsFromDB();
        });

        // حدث تسجيل الدخول
        loginBtn.addEventListener('click', () => {
            const phone = document.getElementById('admin-phone').value;
            const password = document.getElementById('admin-password').value;
            
            if (phone === ADMIN_CREDENTIALS.phone && password === ADMIN_CREDENTIALS.password) {
                // تسجيل الدخول ناجح
                loginContainer.style.display = 'none';
                adminPanel.style.display = 'block';
                localStorage.setItem('adminLoggedIn', 'true');
                
                // تحميل المنتجات الحالية
                loadAdminProducts();
            } else {
                alert('رقم الهاتف أو كلمة المرور غير صحيحة');
            }
        });

        // حدث تسجيل الخروج
        logoutBtn.addEventListener('click', () => {
            localStorage.removeItem('adminLoggedIn');
            adminPanel.style.display = 'none';
        });

        // تهيئة قاعدة البيانات
        function initDatabase() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open('StudentLibraryDB', 1);
                
                request.onerror = () => reject(request.error);
                request.onsuccess = () => resolve(request.result);
                
                request.onupgradeneeded = (event) => {
                    const db = event.target.result;
                    
                    // إنشاء جدول المنتجات إذا لم يكن موجوداً
                    if (!db.objectStoreNames.contains('products')) {
                        const store = db.createObjectStore('products', { keyPath: 'id', autoIncrement: true });
                        store.createIndex('category', 'category', { unique: false });
                    }
                };
            });
        }

        // إضافة منتج جديد
        addProductBtn.addEventListener('click', async () => {
            const name = document.getElementById('product-name').value;
            const price = parseFloat(document.getElementById('product-price').value);
            const desc = document.getElementById('product-desc').value;
            const image = document.getElementById('product-image').value;
            const images = document.getElementById('product-images').value.split(',').map(img => img.trim());
            const category = document.getElementById('product-category').value;
            const tags = document.getElementById('product-tags').value.split(',').map(tag => tag.trim());
            
            if (!name || !price || !desc || !image || !category) {
                alert('يرجى ملء جميع الحقول المطلوبة');
                return;
            }
            
            const newProduct = {
                name,
                price,
                desc,
                image,
                images: images.length > 0 ? images : [image],
                category,
                tags,
                availability: "متوفر",
                rating: 5,
                badge: "جديد"
            };
            
            try {
                const db = await initDatabase();
                const transaction = db.transaction(['products'], 'readwrite');
                const store = transaction.objectStore('products');
                
                const request = store.add(newProduct);
                
                request.onsuccess = () => {
                    alert('تم إضافة المنتج بنجاح!');
                    // مسح الحقول
                    document.getElementById('product-name').value = '';
                    document.getElementById('product-price').value = '';
                    document.getElementById('product-desc').value = '';
                    document.getElementById('product-image').value = '';
                    document.getElementById('product-images').value = '';
                    document.getElementById('product-tags').value = '';
                    
                    // إعادة تحميل قائمة المنتجات
                    loadAdminProducts();
                    
                    // تحديث المتجر
                    loadProductsFromDB();
                };
                
                request.onerror = () => {
                    alert('حدث خطأ أثناء إضافة المنتج');
                };
            } catch (error) {
                console.error('Error adding product:', error);
                alert('حدث خطأ أثناء إضافة المنتج');
            }
        });

        // تحميل المنتجات في لوحة التحكم
        async function loadAdminProducts() {
            try {
                const db = await initDatabase();
                const transaction = db.transaction(['products'], 'readonly');
                const store = transaction.objectStore('products');
                const request = store.getAll();
                
                request.onsuccess = () => {
                    const products = request.result;
                    adminProductsList.innerHTML = '';
                    
                    if (products.length === 0) {
                        adminProductsList.innerHTML = '<p>لا توجد منتجات حتى الآن</p>';
                        return;
                    }
                    
                    products.forEach(product => {
                        const productElement = document.createElement('div');
                        productElement.className = 'admin-product-form';
                        productElement.innerHTML = `
                            <h3>${product.name}</h3>
                            <p><strong>السعر:</strong> ${product.price} جنيه</p>
                            <p><strong>الفئة:</strong> ${product.category}</p>
                            <img src="${product.image}" alt="${product.name}" style="max-width: 100%; height: 150px; object-fit: cover;">
                            <button class="logout-btn delete-product" data-id="${product.id}">حذف المنتج</button>
                        `;
                        
                        adminProductsList.appendChild(productElement);
                    });
                    
                    // إضافة أحداث الحذف
                    document.querySelectorAll('.delete-product').forEach(button => {
                        button.addEventListener('click', async (e) => {
                            const productId = parseInt(e.target.getAttribute('data-id'));
                            if (confirm('هل أنت متأكد من حذف هذا المنتج؟')) {
                                try {
                                    const db = await initDatabase();
                                    const transaction = db.transaction(['products'], 'readwrite');
                                    const store = transaction.objectStore('products');
                                    
                                    const request = store.delete(productId);
                                    
                                    request.onsuccess = () => {
                                        alert('تم حذف المنتج بنجاح');
                                        loadAdminProducts();
                                        loadProductsFromDB();
                                    };
                                    
                                    request.onerror = () => {
                                        alert('حدث خطأ أثناء حذف المنتج');
                                    };
                                } catch (error) {
                                    console.error('Error deleting product:', error);
                                    alert('حدث خطأ أثناء حذف المنتج');
                                }
                            }
                        });
                    });
                };
            } catch (error) {
                console.error('Error loading products:', error);
            }
        }

        // تحميل المنتجات من قاعدة البيانات وعرضها في المتجر
        async function loadProductsFromDB() {
            try {
                const db = await initDatabase();
                const transaction = db.transaction(['products'], 'readonly');
                const store = transaction.objectStore('products');
                const request = store.getAll();
                
                request.onsuccess = () => {
                    const dbProducts = request.result;
                    productsContainer.innerHTML = '';
                    
                    if (dbProducts.length === 0) {
                        productsContainer.innerHTML = '<p style="grid-column: 1 / -1; text-align: center; padding: 2rem;">لا توجد منتجات حتى الآن</p>';
                        return;
                    }
                    
                    dbProducts.forEach((product, index) => {
                        const productCard = document.createElement('div');
                        productCard.className = 'product-card new-product-highlight';
                        productCard.innerHTML = `
                            <div class="product-image" data-id="${product.id}">
                                <img src="${product.image}" alt="${product.name}">
                                <span class="product-badge">${product.badge || 'جديد'}</span>
                            </div>
                            <div class="product-info">
                                <h3 class="product-name">${product.name}</h3>
                                <p class="product-desc">${product.desc}</p>
                                <div class="product-meta">
                                    <span class="product-availability">${product.availability}</span>
                                    <span class="product-rating">${'★'.repeat(product.rating)}${'☆'.repeat(5 - product.rating)}</span>
                                </div>
                                <div class="product-tags">
                                    ${product.tags.map(tag => `<span class="product-tag">${tag}</span>`).join('')}
                                </div>
                                <button class="add-to-cart" data-id="${product.id}">
                                    <i class="fas fa-cart-plus"></i>
                                    أضف للسلة - ${product.price} ج.م
                                </button>
                            </div>
                        `;
                        
                        productsContainer.appendChild(productCard);
                        
                        // إزالة التأثير بعد فترة
                        setTimeout(() => {
                            productCard.classList.remove('new-product-highlight');
                        }, 2000);
                    });
                };
            } catch (error) {
                console.error('Error loading products from DB:', error);
            }
        }

        // تهيئة الصفحة
        async function initPage() {
            // التحقق من حالة تسجيل الدخول
            const isLoggedIn = localStorage.getItem('adminLoggedIn');
            if (isLoggedIn) {
                adminPanel.style.display = 'block';
                loadAdminProducts();
            }
            
            // تحميل المنتجات من قاعدة البيانات
            await loadProductsFromDB();
        }

        // استدعاء تهيئة الصفحة عند تحميل DOM
        document.addEventListener('DOMContentLoaded', initPage);
    </script>
</body>
</html>